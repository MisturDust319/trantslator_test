# borrowed in part from: https://medium.com/@HoussemDellai/run-selenium-ui-tests-in-docker-containers-f41ae2796b8d
services:
    hub:
        image: selenium/hub:latest
        container_name: hub
        ports:
            - "4444:4444"
        expose:
            - 4444
    chrome:
        image: selenium/node-chrome:latest
        deploy:
            replicas: 3
        volumes:
            - /dev/shm:/dev/shm
        depends_on:
            - hub
        environment:
            - HUB_HOST=hub
            - HUB_PORT=4444
    firefox:
        image: selenium/node-firefox:latest
        deploy:
            replicas: 3
        volumes: 
            - /dev/shm:/dev/shm
        depends_on:
            - hub
        environment:
            - HUB_HOST=hub
            - HUB_PORT=4444
    tests:
        image: selenium-tests
        container_name: tests
        depends_on:
            - hub
            - chrome
            - firefox
        command: sh -c "/wait && pytest src/main.py"
        environment:
            - HUB_PORT=4444
            - WAIT_HOSTS=hub:4444
            - WAIT_BEFORE_HOSTS=4
            - WAIT_SLEEP_INTERVAL=3
        volumes:
            - type: bind
              source: ./src
              target: /src